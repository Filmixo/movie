<!DOCTYPE html>  
<html lang="en-US">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <title>Watching Movie | FILMIXO Professional</title>  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>  
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; text-decoration: none; }  
        body { display: flex; justify-content: center; -webkit-tap-highlight-color: transparent; user-select: none; background: #fff; }  
        
        .main-wrapper { width: 100%; max-width: 600px; min-height: 100vh; background: #fff; position: relative; border-left: 1px solid #eee; border-right: 1px solid #eee; opacity: 1; margin: 0 auto; }

        header { background: #0b78d0; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .logo-area { font-weight: 900; font-size: 23px; text-transform: uppercase; line-height: 1; display: flex; align-items: center; }  
        .header-btn { background: white; color: #1da1f2; padding: 6px 15px; border-radius: 15px; font-weight: bold; font-size: 12px; margin-left: 5px; cursor: pointer; transition: transform 0.1s ease; display: inline-flex; align-items: center; justify-content: center; }  
        .header-btn:active { transform: scale(0.98); }
        header > div { display: flex; align-items: center; gap: 2px; }

        .ad-box { width: 100%; height: 0; overflow: hidden; transition: height 0.3s ease, margin 0.3s ease; margin: 0; display: block; }
        .ad-box iframe { width: 100%; border: none; overflow: hidden; display: block; } 

        /* ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶ï‡¶æ‡¶≤‡ßã ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°) */
        .watch-embed-wrapper { position: relative; width: 100%; padding-bottom: 56.25%; height: 0; margin-bottom: 5px; overflow: hidden; background: #000; }
        .watch-embed-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; object-fit: cover; }

        .download-title-text { font-size: 20px; font-weight: 800; color: #0f1419; text-align: center; margin: 5px 0 25px 0; padding: 0 15px; border-top: 1px solid #e1e8ed; padding-top: 15px; }  
        .download-buttons-container { padding: 0 15px; margin-bottom: 20px; display: flex; flex-direction: row; justify-content: space-between; gap: 10px; }  
        .download-btn-v2 { display: flex; flex-direction: row; align-items: center; justify-content: center; flex: 1; padding: 12px 5px; border-radius: 6px; text-align: center; color: white; cursor: pointer; transition: transform 0.1s ease; border: 1px solid rgba(255, 255, 255, 0.15); gap: 5px; }
        .download-btn-v2:active { transform: scale(0.98); }
        .btn-text-main { font-size: 11px; font-weight: 900; letter-spacing: 0.1px; white-space: nowrap; }

        .site-footer { padding: 20px 10px; text-align: center; border-top: 1px solid #eee; }  
        .footer-links { display: flex; justify-content: center; gap: 12px; margin-bottom: 15px; flex-wrap: nowrap; }  
        .footer-links a { color: #444444; font-size: 12.5px; font-weight: 600; white-space: nowrap; transition: color 0.1s, transform 0.1s; display: inline-block; } 
        .footer-links a:active { color: #1da1f2 !important; transform: scale(0.97); }
        .footer-copyright { color: #536471; font-size: 13px; }  
        .footer-copyright a { color: #1da1f2; font-weight: bold; }
    </style>
</head>  
<body>  

<template id="ad-src-top"><script>atOptions={'key':'caf6ea59dc8711a1d0bfb5ad9dd98638','format':'iframe','height':90,'width':728,'params':{}};</script><script src="https://prototypesorting.com/caf6ea59dc8711a1d0bfb5ad9dd98638/invoke.js"></script></template>
<template id="ad-src-video"><script>atOptions={'key':'dbae51ad68fb44f5c8a6b535812c9f54','format':'iframe','height':250,'width':300,'params':{}};</script><script src="https://prototypesorting.com/dbae51ad68fb44f5c8a6b535812c9f54/invoke.js"></script></template>

<div class="main-wrapper">  
    <header>  
        <div class="logo-area"><i class="fa-solid fa-clapperboard" style="margin-right: 8px;"></i>FILMIXO</div>
        <div>  
            <span class="header-btn" onclick="window.location.href='index.html'"><i class="fa-solid fa-house" style="margin-right: 5px;"></i>Home</span>
        </div>  
    </header>  

    <div id="ad-box-top" class="ad-box"></div>

    <div id="video-container"></div>

    <div id="ad-box-video" class="ad-box"></div>

    <div id="download-section-container"></div>

    <footer class="site-footer">  
        <div class="footer-links"> 
            <a href="about.html">About Us</a> 
            <a href="contact.html">Contact Us</a> 
            <a href="privacy.html">Privacy Policy</a> 
            <a href="terms.html">Terms & Conditions</a> 
        </div>  
        <div class="footer-copyright">Copyright ¬© 2026 <a href="index.html">filmixo.com</a>. All rights reserved.</div>  
    </footer>  
</div>  

<script type="module">  
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";  
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";  
  
    const firebaseConfig = { apiKey: "AIzaSyCAsD8wucLsudzY5oNbiixLGyjN2apdV0Q", authDomain: "my-ad-analytics-4560a.firebaseapp.com", projectId: "my-ad-analytics-4560a", storageBucket: "my-ad-analytics-4560a.firebasestorage.app", messagingSenderId: "104213283950", appId: "1:104213283950:web:b5a25ecd54df809625127f" };  
    const app = initializeApp(firebaseConfig);  
    const db = getFirestore(app);  
    
    const urlParams = new URLSearchParams(window.location.search);  
    const postId = urlParams.get('id');  

    // ‡ßß‡ß¶‡ß¶% ‡¶Ö‡¶∞‡¶ø‡¶ú‡¶ø‡¶®‡¶æ‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (post.html ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ)
    window.handleDownloadClick = (btnId, pId, ad1, ad2) => {
        const key = `map_${pId}`;
        let map = JSON.parse(localStorage.getItem(key)) || {};
        if (map[btnId]) {
            location.href = (map[btnId] === 'ad1') ? ad1 : ad2;
            return;
        }
        let assignedCount = Object.keys(map).length;
        if (assignedCount < 2) {
            const taskType = (assignedCount === 0) ? 'ad1' : 'ad2';
            const adLink = (assignedCount === 0) ? ad1 : ad2;
            sessionStorage.setItem('pendingDownloadTask', JSON.stringify({ id: btnId, type: taskType, key: key, blurTime: Date.now() }));
            location.href = adLink;
        } else {
            localStorage.removeItem(key);
            location.href = `download.html?id=${pId}`;
        }
    };

    function injectAd(tid, cid) {
        const t = document.getElementById(tid), c = document.getElementById(cid);
        if (!t || !c) return;
        const iframe = document.createElement('iframe');
        iframe.style.width = '100%'; iframe.style.height = '1px'; iframe.style.border = 'none'; iframe.scrolling = 'no';
        c.appendChild(iframe);
        const doc = iframe.contentWindow.document;
        doc.open(); doc.write(`<html><body style="margin:0;display:flex;justify-content:center;">${t.innerHTML}<script>function rs(){const h=document.body.scrollHeight; if(h>10 && window.frameElement){const frame=window.frameElement; frame.style.height=h+'px'; const parent=frame.parentElement; parent.style.height=h+'px'; parent.style.marginTop='4px'; parent.style.marginBottom='4px';}} window.onload=rs; setInterval(rs,600);<\/script></body></html>`); doc.close();
    }

    async function initWatch() {
        if (!postId) { window.location.href = 'index.html'; return; }
        const docSnap = await getDoc(doc(db, "posts", postId));

        if (docSnap.exists()) {
            const post = docSnap.data();
            const grads = ["linear-gradient(180deg, #D32F2F 0%, #B71C1C 100%)", "linear-gradient(180deg, #1976D2 0%, #0D47A1 100%)", "linear-gradient(180deg, #388E3C 0%, #1B5E20 100%)"];

            // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
            if(post.youtubeEmbed) {
                document.getElementById('video-container').innerHTML = `
                    <div class="watch-embed-wrapper">
                        ${post.youtubeEmbed.replace('<iframe', '<iframe allow="autoplay; fullscreen"')}
                    </div>`;
            }

            // ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ (‡ßß‡ß¶‡ß¶% ‡¶ï‡¶™‡¶ø)
            document.getElementById('download-section-container').innerHTML = `
                <div class="download-title-text">‚ÜïÔ∏èüî∞ Download Full Movie in HD üî∞‚ÜïÔ∏è</div>
                <div class="download-buttons-container">
                    <div onclick="handleDownloadClick('b1','${post.id}','${post.adLink1}','${post.adLink2}')" class="download-btn-v2" style="background:${grads[0]}"><i class="fa-solid fa-circle-down"></i> <span class="btn-text-main">1080P FULL HD</span></div>
                    <div onclick="handleDownloadClick('b2','${post.id}','${post.adLink1}','${post.adLink2}')" class="download-btn-v2" style="background:${grads[1]}"><i class="fa-solid fa-download"></i> <span class="btn-text-main">720P HD READY</span></div>
                    <div onclick="handleDownloadClick('b3','${post.id}','${post.adLink1}','${post.adLink2}')" class="download-btn-v2" style="background:${grads[2]}"><i class="fa-solid fa-file-arrow-down"></i> <span class="btn-text-main">360P MOBILE</span></div>
                </div>`;

            // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶á‡¶®‡¶ú‡ßá‡¶ï‡ßç‡¶ü
            injectAd('ad-src-top', 'ad-box-top');
            injectAd('ad-src-video', 'ad-box-video');
        } else {
            window.location.href = 'index.html';
        }
    }

    // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶≤‡¶ú‡¶ø‡¶ï (post.html ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ)
    window.addEventListener('load', () => {
        const savedTask = sessionStorage.getItem('pendingDownloadTask');
        if (savedTask) {
            const task = JSON.parse(savedTask);
            if (Date.now() - task.blurTime >= 5000) {
                let map = JSON.parse(localStorage.getItem(task.key)) || {};
                map[task.id] = task.type;
                localStorage.setItem(task.key, JSON.stringify(map));
            }
            sessionStorage.removeItem('pendingDownloadTask');
        }
    });

    initWatch();
</script>  
</body>  
</html>
